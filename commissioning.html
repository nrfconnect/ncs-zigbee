<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Commissioning &mdash; Zigbee add-on for nRF Connect SDK 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/nordic.css" type="text/css" />
      <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/js/theme.js"></script>
  <script type="text/javascript" src="_static/js/ncs.js"></script>

    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Memory requirements" href="memory.html" />
    <link rel="prev" title="Architectures" href="architectures.html" />
  <link rel="shortcut icon" href="_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Zigbee add-on for nRF Connect SDK
          </a>
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About Zigbee protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Requirements and setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="architectures.html">Architectures</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Commissioning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#start-of-commissioning">Start of commissioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#commissioning-modes">Commissioning modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#touchlink">Touchlink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network-steering">Network Steering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network-formation">Network Formation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#centralized-security-network">Centralized security network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributed-security-network">Distributed security network</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#finding-and-binding">Finding and Binding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#end-of-commissioning">End of commissioning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Memory requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring.html">Configuring Zigbee add-on</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring/index.html">Additional configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="zboss/index.html">ZBOSS Zigbee stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="samples/index.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="lib/index.html">Libraries for Zigbee</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Zigbee add-on for nRF Connect SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Commissioning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/commissioning.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="commissioning">
<span id="ug-zigbee-commissioning"></span><h1>Commissioning<a class="headerlink" href="#commissioning" title="Permalink to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#start-of-commissioning" id="id6">Start of commissioning</a></p></li>
<li><p><a class="reference internal" href="#commissioning-modes" id="id7">Commissioning modes</a></p>
<ul>
<li><p><a class="reference internal" href="#touchlink" id="id8">Touchlink</a></p></li>
<li><p><a class="reference internal" href="#network-steering" id="id9">Network Steering</a></p></li>
<li><p><a class="reference internal" href="#network-formation" id="id10">Network Formation</a></p></li>
<li><p><a class="reference internal" href="#finding-and-binding" id="id11">Finding and Binding</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#end-of-commissioning" id="id12">End of commissioning</a></p></li>
</ul>
</nav>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an <a class="reference external" href="https://docs.nordicsemi.com/bundle/ncs-latest/page/nrf/releases_and_maturity/software_maturity.html">experimental</a> release of Zigbee support for the nRF54L Series.</p>
</div>
<p>Commissioning is a process that allows a new Zigbee device to join a Zigbee network.
The device is configured into the network, so that it can start communicating with other network nodes.
If there is no network to join, the commissioning procedure ensures that a new network is created.</p>
<p>You can configure Zigbee commissioning by setting parameters before the start of the <a class="reference internal" href="zboss/index.html#zigbee-zboss"><span class="std std-ref">ZBOSS Zigbee stack</span></a>.
For more information, see the <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/using_zigbee__z_c_l.html#zcl_zigbee_commissioning">Support for Zigbee commissioning</a> section in the ZBOSS stack documentation.</p>
<section id="start-of-commissioning">
<span id="zigbee-commissioning-start"></span><h2><a class="toc-backref" href="#id6" role="doc-backlink">Start of commissioning</a><a class="headerlink" href="#start-of-commissioning" title="Permalink to this heading"></a></h2>
<p>There are several ways the commissioning process can be started, according to the <a class="reference external" href="https://csa-iot.org/developer-resource/specifications-download-request/">Zigbee Specification</a>:</p>
<ul class="simple">
<li><p>Automatically after device initialization.</p></li>
<li><p>With a user action, for example a button press or a command.</p></li>
<li><p>Over the air, using a mechanism defined in the Identify cluster.</p></li>
</ul>
<p>In the ZBOSS stack, the commissioning can be started using one of the following options:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zb__general__start.html#ga31b4d46033aaf6a400409d03bd40d392">zboss_start()</a> that initializes the stack and starts the BDB commissioning procedure with the default modes (Network Steering, Network Formation, Finding and Binding).</p></li>
<li><p><a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zboss__bdb__comm__start.html#ga0b54e93a19cadc5fc02df8eab18ecd45">bdb_start_top_level_commissioning()</a> that should be started after the stack initialization (for example, from the ZBOSS signal handler) and requires providing the commissioning mode’s <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zboss__bdb__comm__start.html#ga9c44bbce9f6f6b19b623837914959c02">zb_bdb_commissioning_mode_mask_e</a> mask.</p></li>
</ul>
<p>For more information, see the <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/using_zigbee__z_c_l.html#stack_start_initiation">Stack commissioning start sequence</a> section in the ZBOSS stack documentation.</p>
<p>With the Zigbee add-on, the application can use <a class="reference internal" href="lib/zigbee_app_utils.html#lib-zigbee-signal-handler"><span class="std std-ref">Zigbee default signal handler</span></a> to handle the ZBOSS signals and start the commissioning.</p>
</section>
<section id="commissioning-modes">
<span id="zigbee-commissioning-modes"></span><h2><a class="toc-backref" href="#id7" role="doc-backlink">Commissioning modes</a><a class="headerlink" href="#commissioning-modes" title="Permalink to this heading"></a></h2>
<p>Zigbee commissioning is organized into four different modes:</p>
<ul class="simple">
<li><p>Touchlink commissioning (optional; not supported in the Zigbee add-on for the nRF Connect SDK)</p></li>
<li><p>Network Steering</p></li>
<li><p>Network Formation</p></li>
<li><p>Finding and Binding (optional)</p></li>
</ul>
<p>These modes are triggered by the top-level commissioning procedure.
The procedure goes through one or more modes, depending on the bits specified in the <code class="docutils literal notranslate"><span class="pre">bdbCommissioningMode</span></code> mask (<code class="docutils literal notranslate"><span class="pre">0</span></code> through <code class="docutils literal notranslate"><span class="pre">3</span></code>).
A node can have one or more of these bits set.</p>
<p>The following figure shows a generic scenario where all modes are used, together with their corresponding <code class="docutils literal notranslate"><span class="pre">bdbCommissioningMode</span></code> mask bits:</p>
<figure class="align-default" id="id2">
<img alt="Simplified top-level Zigbee commissioning procedure" src="_images/zigbee_commissioning_overview.svg" /><figcaption>
<p><span class="caption-text">Generic top-level Zigbee commissioning procedure</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>This top-level procedure defines the intended order of execution of Zigbee commissioning modes.
The commissioning procedure is common for all device roles, but some modes might not be executed for a given role.
For example, Network Formation is not executed for End Devices.</p>
<p>See the following sections for details about each mode.</p>
<section id="touchlink">
<span id="zigbee-commissioning-modes-touchlink"></span><h3><a class="toc-backref" href="#id8" role="doc-backlink">Touchlink</a><a class="headerlink" href="#touchlink" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Touchlink mode is optional in Zigbee and is not supported in the Zigbee add-on for the nRF Connect SDK.</p>
</div>
<p>The Touchlink mode allows commissioning of devices in close proximity to each other, which means that the key criterium for this mode is the signal strength.
It involves an initiator device and a target device, where the initiator is a member of an existing Zigbee network or it can form a new network.
Once the network is created, the initiator looks for the target on four channels by sending InterPAN frames.
When the target is found, the initiator can create a local binding with a remote endpoint or request adding the remote endpoint to a group.
The target first identifies itself with the initiator and then receives requests from it and responds to them.</p>
<p>Touchlink only supports <a class="reference internal" href="#distributed-security-network">Distributed security network</a> and it is provided as a ZCL cluster, which needs to be implemented on both the initiator and the target devices.</p>
</section>
<section id="network-steering">
<span id="zigbee-commissioning-modes-ns"></span><h3><a class="toc-backref" href="#id9" role="doc-backlink">Network Steering</a><a class="headerlink" href="#network-steering" title="Permalink to this heading"></a></h3>
<p>The Network Steering mode is used for finding open networks that a device can attempt to join or open a network for a specified period of time.</p>
<figure class="align-default" id="id3">
<img alt="Zigbee Network Steering procedure" src="_images/zigbee_commissioning_steering.svg" /><figcaption>
<p><span class="caption-text">Zigbee Network Steering procedure</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>How the node acts in this mode depends on whether the node is in a Zigbee network or not:</p>
<ul class="simple">
<li><p>If the node is already a member of a Zigbee network, it opens the network and then closes it after the specified period of time (180 seconds by default).
The opening of the network is triggered when any of the Router or Coordinator nodes broadcasts the permit join request.</p></li>
<li><p>If the node is not a member of a Zigbee network, it scans channels for an open network to associate with.
Once it finds a suitable network, it attempts to join it and get the credentials.
If the node finds more than one available network, it will attempt to join one of them, one by one.</p></li>
</ul>
<p>If the node does not find a network to join and it has either the Coordinator or the Router role, it can attempt to form a new network (see <a class="reference internal" href="#network-formation">Network Formation</a>).
If the node has the End Device role, its commissioning procedure stops here.</p>
<p>If the node finds a network to join, it can continue to the <a class="reference internal" href="#finding-and-binding">Finding and Binding</a> procedure if it is requested with the appropriate bit mask value.</p>
<p>The new device must be authenticated and authorized to become part of the network.
For this purpose, it needs credentials, which usually take form of a network key.
For <a class="reference internal" href="#centralized-security-network">Centralized security network</a>, the authentication and authorization also involves establishing a unique Trust Center Link Key (TCLK).</p>
<dl>
<dt>Network Steering in the Zigbee add-on for the nRF Connect SDK</dt><dd><p>In the ZBOSS stack, Network Steering is started using the <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zboss__bdb__comm__start.html#gga9c44bbce9f6f6b19b623837914959c02ae31d4a2067eb711a43f7049b08710299">ZB_BDB_NETWORK_STEERING</a> bit mask.</p>
<p>In the Zigbee add-on, Network Steering for a node on a network can be started using the following additional options:</p>
<ul class="simple">
<li><p>When running the <a class="reference internal" href="samples/network_coordinator/README.html#zigbee-network-coordinator-sample"><span class="std std-ref">Zigbee Coordinator sample</span></a>, you can press the associated button.</p></li>
<li><p>If you are using the <a class="reference internal" href="lib/shell.html#lib-zigbee-shell"><span class="std std-ref">Zigbee shell</span></a> library in your application, you can use the <code class="docutils literal notranslate"><span class="pre">bdb</span> <span class="pre">start</span></code> command.
This command always starts Network Steering for the Router role.
For the Coordinator role, this command only starts Network Steering when the device is in the network; when not in the network, <code class="docutils literal notranslate"><span class="pre">bdb</span> <span class="pre">start</span></code> starts Network Formation.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="network-formation">
<span id="zigbee-commissioning-modes-nf"></span><h3><a class="toc-backref" href="#id10" role="doc-backlink">Network Formation</a><a class="headerlink" href="#network-formation" title="Permalink to this heading"></a></h3>
<p>The Network Formation mode is available only to Coordinators and Routers, because End Devices are not capable of forming a Zigbee network.</p>
<figure class="align-default" id="id4">
<img alt="Zigbee Network Formation procedure" src="_images/zigbee_commissioning_formation.svg" /><figcaption>
<p><span class="caption-text">Zigbee Network Formation procedure</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>In this mode, the node has not found a network to join during the Network Steering mode, and so it attempts to form a new network.
Depending on the node role:</p>
<ul class="simple">
<li><p>A Coordinator forms a centralized security network.</p></li>
<li><p>If configured for forming a network, a Router forms a distributed security network.</p></li>
</ul>
<p>If Network Formation is successful, you can add nodes to the new network using <a class="reference internal" href="#network-steering">Network Steering</a>.
If unsuccessful, the commissioning procedure stops here.</p>
<dl>
<dt>Network Formation in the Zigbee add-on for the nRF Connect SDK</dt><dd><p>In the ZBOSS stack, Network Formation is started using the <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zboss__bdb__comm__start.html#gga9c44bbce9f6f6b19b623837914959c02ac723cfd38f78c08a673ec3664539027c">ZB_BDB_NETWORK_FORMATION</a> bit mask.</p>
<p>In the Zigbee add-on, when using the <a class="reference internal" href="lib/zigbee_app_utils.html#lib-zigbee-signal-handler"><span class="std std-ref">Zigbee default signal handler</span></a> and the application implements the Zigbee Coordinator role, the Network Formation procedure is started right after the stack initialization.</p>
</dd>
</dl>
<section id="centralized-security-network">
<h4>Centralized security network<a class="headerlink" href="#centralized-security-network" title="Permalink to this heading"></a></h4>
<p>The centralized security network is started by the Zigbee Coordinator node, which assumes the Trust Center functionality.
As such, it is responsible for managing the security and authorization in the network.
In the centralized security network, only the Trust Center can provide the network key to the joining device.
This happens by using a link key specific to the joining device.
The link key is exchanged with the Trust Center, which allows for encrypting packets exchanged between the Trust Center and the new node.
This way, only the Trust Center and the new node can decrypt the packages exchanged between them.
Initially, the link key value can be defined in one of the following ways:</p>
<ul class="simple">
<li><p>Calculated based on the joining device’s install code.</p></li>
<li><p>Predefined in the specification: <code class="docutils literal notranslate"><span class="pre">&quot;ZigBeeAlliance09&quot;</span></code>.</p></li>
</ul>
<p>The link key value can be updated from the initial value by requesting a new key from the Trust Center.</p>
</section>
<section id="distributed-security-network">
<h4>Distributed security network<a class="headerlink" href="#distributed-security-network" title="Permalink to this heading"></a></h4>
<p>The distributed security network is formed by Routers and does not have a centralized node that manages security in the network.
In this network type, all Routers are equal and there is no root of trust between them.
Each Router can provide the network key to the joining device.
This happens by using a distributed security global link key.
The link key value is provided as a result of a successful end product certification.</p>
</section>
</section>
<section id="finding-and-binding">
<span id="zigbee-commissioning-modes-fb"></span><h3><a class="toc-backref" href="#id11" role="doc-backlink">Finding and Binding</a><a class="headerlink" href="#finding-and-binding" title="Permalink to this heading"></a></h3>
<p>After the node joins a network, it can undergo the Finding and Binding procedure.
With this procedure, you can establish a connection between corresponding endpoints on two different nodes automatically.
As a result, new binding table entries are created and the nodes do not have to use the device addresses to communicate, but can rely on connections between the same endpoints in their respective cluster binding tables.</p>
<figure class="align-default" id="id5">
<img alt="Zigbee Finding and Binding procedure" src="_images/zigbee_commissioning_fb.svg" /><figcaption>
<p><span class="caption-text">Zigbee Finding and Binding procedure</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Finding and Binding can be started automatically (using the <code class="docutils literal notranslate"><span class="pre">bdbCommissioningMode</span></code> mask) or manually.
The process involves two device types: target and initiator.
The device type is defined by the endpoint cluster class implemented on the device.
Depending on the device type:</p>
<ul class="simple">
<li><p>The target node identifies itself and responds to queries from the initiator.</p></li>
<li><p>The initiator starts Finding and Binding and periodically searches for endpoints on the target.
When it receives a response, it identifies the endpoint on target with a ZDO simple descriptor request and creates connections with the clusters corresponding to the ones on the initiator.
This connection can either be a binding (entry in the binding table) or a grouping (addition of the target node address to the address group).
The procedure is performed using ZDO simple descriptor requests and responses for each endpoint pair, for each matching Zigbee cluster client and server pair for the endpoint.</p></li>
</ul>
<p>Finding and Binding can be terminated if there are no corresponding clusters on the target node.</p>
<dl>
<dt>Finding and Binding in the Zigbee add-on for the nRF Connect SDK</dt><dd><p>In the ZBOSS stack, Finding and Binding is started using the <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zboss__bdb__comm__start.html#gga9c44bbce9f6f6b19b623837914959c02ad9bcb56a6668b6ba6f37edc73a796b58">ZB_BDB_FINDING_N_BINDING</a> bit mask.</p>
<p>Apart from the BDB top-level procedure API, you can use the <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zboss__bdb__comm__fb.html#gae6fd60a050559ef0aa3c3e5ec32bc515">zb_bdb_finding_binding_initiator()</a> function to manually control which binding table entries are to be created.
For more information, see the <a class="reference external" href="https://nrfconnect.github.io/ncs-zigbee/zboss/4.1.4.2/group__zboss__bdb__api.html">BDB Commissioning API</a> section in the ZBOSS stack documentation.</p>
</dd>
</dl>
</section>
</section>
<section id="end-of-commissioning">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">End of commissioning</a><a class="headerlink" href="#end-of-commissioning" title="Permalink to this heading"></a></h2>
<p>The top-level commissioning procedure ends when all the requested commissioning modes are done or the commissioning procedure stops.</p>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="memory.html" class="btn btn-neutral float-right" title="Memory requirements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="architectures.html" class="btn btn-neutral" title="Architectures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2024, Nordic Semiconductor.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="_static/images/nordic.svg" border="0"/></a>
</td>
</tr>
</table>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>